#!/bin/bash
CNAME=pkg-test
[ -z "$1" ] && echo "Please specify a catpkg to test." && exit 1
network_test() {
	foo="$(lxc exec $CNAME -- ifconfig eth0 | grep 'inet 10.')"
	if [ -n "$foo" ]; then
		echo "yes"
	else
		echo "no"
	fi
}

lxc launch pkg-test $CNAME
echo -n "Waiting for network."
while [ "$(network_test)" != "yes" ]; do
	echo -n "."
done
lxc exec $CNAME -- ego sync 
lxc exec $CNAME -- emerge -u --jobs $1
